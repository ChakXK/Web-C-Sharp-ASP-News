@using Microsoft.AspNet.Identity
@using System.Linq;
@using System.Threading.Tasks;
@using System.Net;
@using System.Web;
@using System.Web.Mvc;
@using news.Models;


@{ApplicationDbContext db = new ApplicationDbContext();
    var categories = db.Categories.ToList();
    var all = db.Articles.OrderByDescending(a => a.Datetime).Take(4).ToList();
    }

<!-- ПОСЛЕДНЕЕ -->
<!-- SECTION -->
<div class="section">
    <!-- CONTAINER -->
    <div class="container">
        <!-- ROW -->
        <div class="row">
            <!-- Main Column -->
            <div class="col-md-12">
                <!-- section title -->
                <div class="section-title">
                    <h2 class="title">ПОСЛЕДНЕЕ</h2>
                    <!-- tab nav -->
                    <ul class="tab-nav pull-right">
                        <li class="active"><a data-toggle="tab" href="#all">Все</a></li>
                        @foreach (var category in categories)
                        {
                            <li><a data-toggle="tab" href="#@category.Name">@category.Name</a></li>
                        }
                    </ul>
                    <!-- /tab nav -->
                </div>
                <!-- /section title -->
                <!-- Tab content -->
                <div class="tab-content">

                    <!-- tab -->
                    <div id="all" class="tab-pane fade in active">
                        <!-- row -->
                        <div class="row">
                            @foreach (var a in all)
                            {
                                <!-- Column -->
                                <div class="col-md-3 col-sm-6">
                                    <!-- ARTICLE -->
                                    <article class="article">
                                        <div class="article-img">
                                            <a href="/Articles/Details/@a.Id">
                                                <img src="@Url.Content("~/Content/imgfiles/" + a.Images.Where(img => img.Number == 1)?.First()?.Id +
a.Images.Where(img => img.Number == 1)?.First()?.Name)" alt="">
                                            </a>
                                            <ul class="article-info">
                                            </ul>
                                        </div>
                                        <div class="article-body">
                                            <h4 class="article-title"><a href="/Articles/Details/@a.Id">@a.Heading</a></h4>
                                            <ul class="article-meta">
                                                <li><i class="fa fa-clock-o"></i> @a.Datetime</li>
                                                <li><i class="fa fa-comments"></i>@a.Comments.Count</li>
                                            </ul>
                                        </div>
                                    </article>
                                    <!-- /ARTICLE -->
                                </div>
                                <!-- /Column  -->
                            }
                        </div>
                        <!-- /row -->
                    </div>
                    <!-- /tab -->

                    @foreach (var category in categories)
                    {
                        <!-- tab -->
                        <div id="@category.Name" class="tab-pane fade">
                            <!-- row -->
                            <div class="row">
                                @foreach (var a in category.Articles.OrderByDescending(ar => ar.Datetime).Take(4))
                                {
                                    <!-- Column  -->
                                    <div class="col-md-3 col-sm-6">
                                        <!-- ARTICLE -->
                                        <article class="article">
                                            <div class="article-img">
                                                <a href="/Articles/Details/@a.Id">
                                                    <img src="@Url.Content("~/Content/imgfiles/" + a.Images.Where(img => img.Number == 1)?.First()?.Id +
a.Images.Where(img => img.Number == 1)?.First()?.Name)" alt="">
                                                </a>
                                                <ul class="article-info">
                                                </ul>
                                            </div>
                                            <div class="article-body">
                                                <h4 class="article-title"><a href="/Articles/Details/@a.Id">@a.Heading</a></h4>
                                                <ul class="article-meta">
                                                    <li><i class="fa fa-clock-o"></i> @a.Datetime</li>
                                                    <li><i class="fa fa-comments"></i>@a.Comments.Count</li>
                                                </ul>
                                            </div>
                                        </article>
                                        <!-- /ARTICLE -->
                                    </div>
                                    <!-- /Column -->
                                }
                                </div>
                            <!-- /row -->
                        </div>
                        <!-- /tab -->
                    }
                </div>
                <!-- /tab content -->
            </div>
            <!-- /Main Column -->
        </div>
        <!-- /ROW -->
    </div>
    <!-- /CONTAINER -->
</div>
<!-- /SECTION -->
